/// 首页用于保存求职者用户信息的模块

const loading = require('../../utils/loading_util');
const $ = require('../../utils/request_util');
const app = getApp();

/* --- Meta --- */
class Salary {
    constructor(min, max) {
        this.min = min;
        this.max = max;
        this.value = `${min}K - ${max}K`;
    }

    copyTo(info) {
        info.expectSalaeryMin = this.min;
        info.expectSalaeryMax = this.max;
    }
}

const salaryList = [
    new Salary(3, 5),
    new Salary(5, 8),
    new Salary(8, 10),
];

const genderList = [
    '女', '男',
]


// 招聘人信息
const createRecruiteeData = () => ({
    realName: null,
    identityCard: null,
    gender: 0,
    // salaryList index
    salary: 0,
    expectCatagoryId: [],
    expectSalaeryMin: 0,
    expectSalaeryMax: 0,
    genderList: genderList,
    salaryList: salaryList,
});

// TODO: 输入校验
const createRecruiteeMethods = () => ({
    handleRealName: function (e) {
        var value = e.detail.value;
        console.log(value);
        this.setData({
            realName: value,
        });
    },
    handleIdentityCard: function (e) {
        var value = e.detail.value;
        console.log(value);
        this.setData({
            identityCard: value,
        })
    },
    // 选择性别
    selectGender(e) {
        let that = this;
        let index = e.currentTarget.dataset.index1;
        console.debug(`性别设置为 [${index}]: ${genderList[index]}`);
        that.setData({
            gender: index
        })
    },
    // 选择薪资
    selectSalary(e) {
        let that = this;
        let index = e.currentTarget.dataset.index3;
        console.debug(`性别设置为 [${index}]: ${salaryList[index].value}`);
        that.setData({
            salary: index
        })
    },
    // 提交信息
    _getRecruiteeInfo() {
        let data = this.data;
        let salary = salaryList[data.salary];
        return {
            // id 即是 open id
            id: wx.getStorageSync('openid'),
            realName: data.realName,
            identityCard: data.identityCard,
            gender: data.gender,
            expectSalaryMin: salary.min,
            expectSalaryMax: salary.max,
        }
    },
    commitRecruitInfo() {
        let recruiteeInfo = this._getRecruiteeInfo();
        loading.wrap(() => $.request({
          url: app.globalData.web_path + '/user-candidate/add',
          data: recruiteeInfo,
          method: $.RequestMethod.POST,
          header: $.jsonHeader,
        }), '信息提交中');
        this.setData({
          infows: true
        })
      },
});

module.exports = {
    createRecruiteeMethods: createRecruiteeMethods,
    createRecruiteeInfo: createRecruiteeData,
    salaryList: salaryList,
    Salary: Salary,
};

