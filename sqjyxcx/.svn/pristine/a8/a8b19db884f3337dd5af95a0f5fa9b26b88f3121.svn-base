const { Api } = require('../../common/api');
const $ = require('../../utils/request_util');
const user = require('../../common/user')
const loading = require('../../utils/loading_util');
const { Salary } = require('../../common/user');

const openid = wx.getStorageSync('openid');


const createRecruitMethods = () => ({
    loadRecruiteeInfo: async function () {
        loading.begin();
        try {
            // TODO: 在一个接口里获取所有信息
            let recruiteeInfo = await $.request({
                url: Api.userCandidateInfo,
                data: {
                    openid: openid,
                },
            }).then(r => r.data);

            let userInfo = await $.request({
                url: Api.userInfo,
                data: {
                    openid: openid,
                },
            }).then(r => r.data);

            this.setData({
                // 暂时只有一个数据
                personinfo: [{
                    tximg: userInfo.avatarurl,
                    name: recruiteeInfo.realName,
                    sex: user.genderList[recruiteeInfo.gender],
                    year: '23',
                    cellphone: '13111111111',
                    jobname: '保洁人员',
                    money: new Salary(
                        recruiteeInfo.expectSalaryMin,
                        recruiteeInfo.expectSalaryMax,
                    ).value,
                    msgw: '34',
                    ytdgw: '127',
                    byll: recruiteeInfo.countView,
                }],
            })
        } catch (e) {
            console.error(e);
        } finally{
            loading.end();
        }
    }
});


module.exports = {
    createRecruitMethods: createRecruitMethods,
}