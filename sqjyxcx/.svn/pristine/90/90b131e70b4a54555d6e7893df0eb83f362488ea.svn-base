// pages/mine/mine.js

const user = require("../../common/user");
const recruitee = require('./recruitee');

Page({

	/**
	 * 页面的初始数据
	 */
	data: {
		personinfo: [
			{
				tximg: '/img/tx.png',
				name: '张三',
				sex: '女',
				year: '23',
				cellphone: '13111111111',
				jobname: '保洁人员',
				money: '3000-5000',
				msgw: '34',
				ytdgw: '127',
				byll: '55',
			}
		],
		companyinfo: [
			{
				tximg: '/img/tx.png',
				name: '张三',
				// sex:'女',
				// year:'23',
				companyname: '长沙竟网信息科技有限公司',
				jobname: '保洁人员',
				money: '3000-5000',
				msgw: '34',
				ytdgw: '127',
				byll: '55',
			}
		],

		nowsf: '求职者',
		ident: '招聘方',
		userinfo: false
	},
	changeident() {
		let that = this
		let ident = this.data.ident
		let nowsf = this.data.nowsf
		wx.showModal({
			title: '提示',
			content: '您当前是' + nowsf + '身份，点击[确认]可切换至' + ident + '身份',
			success(res) {
				if (res.confirm) {
					that.setData({
						userinfo: false
					})
				} else if (res.cancel) {
				}
			}
		})
	},
	changeident1() {
		let that = this
		let ident = this.data.ident
		let nowsf = this.data.nowsf
		wx.showModal({
			title: '提示',
			content: '您当前是' + ident + '身份，点击[确认]可切换至' + nowsf + '身份',
			success(res) {
				if (res.confirm) {
					that.setData({
						userinfo: true
					})
				} else if (res.cancel) {
				}
			}
		})
	},
	/**
	 * 生命周期函数--监听页面加载
	 */
	onLoad: async function (options) {
		await this._loadUserRole();
		await this._loadUserInfo();
	},

	/**
	 * 生命周期函数--监听页面初次渲染完成
	 */
	onReady: function () {

	},

	/**
	 * 生命周期函数--监听页面显示
	 */
	onShow: function () {

	},

	/**
	 * 生命周期函数--监听页面隐藏
	 */
	onHide: function () {

	},

	/**
	 * 生命周期函数--监听页面卸载
	 */
	onUnload: function () {

	},

	/**
	 * 页面相关事件处理函数--监听用户下拉动作
	 */
	onPullDownRefresh: function () {

	},

	/**
	 * 页面上拉触底事件的处理函数
	 */
	onReachBottom: function () {

	},

	/**
	 * 用户点击右上角分享
	 */
	onShareAppMessage: function () {

	},

	_loadUserRole: async function () {
		
		try {
			let role = await user.loadUserRole();
			console.log(`role: ${role}`);
			let isRecruitee = null;
			switch (role) {
				// 应聘人
				case user.UserRole.Recruitee:
					isRecruitee = true;
					break;
				case user.UserRole.Recruiter:
					isRecruitee = false;
					break;
				// TODO: 实现社区工作人员

				case user.UserRole.CommunityPersonel:
				default:
					console.error("未实现社区人员")
					break;
			}

			this.setData({
				userinfo: isRecruitee
			})

		} catch (e) {
			// TODO: 没有检测到登录的用户角色，跳转首页要求用户选择
			console.error(e);
		}
	},

	_loadUserInfo: async function () {
		// 是求职者，加载求职者信息
		if (this.data.userinfo) {
			this.loadRecruiteeInfo();
		}
		// 招聘人员
		else {

		}
	},

	...recruitee.createRecruitMethods(),
})